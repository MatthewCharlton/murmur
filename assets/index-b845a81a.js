import{c as h,a as l,i as m,S as w,t as b,u as g,s as c,D as u}from"./index-1f9a76af.js";import d from"./index-fb2f375b.js";import"./browser-ponyfill-5ce9a37a.js";const _=b('<div class="fixed bottom-5 mx-5 right-0 z-10 bg-white border-2 p-4 max-w-md min-h-10">Install the murmur web app to your device<br><br> </div>'),I="BJfNA6Vn9RS-6mQq5mnS7nZrMMzUQUcG9_fkMab_dj3dmxrzCewj-WRSijzs0kbYQVteJbS-9dMcDn-4wAfm4Dk",p="murmur-pwa-install-decline",y=7889238e3,D=()=>{"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(async i=>{i.pushManager.getSubscription().then(async t=>{const n=g().username;if(t){const{data:a,error:e}=await c.from(u).select();if(e){console.error(e);return}if(a?.some(o=>o.subscription===JSON.stringify(t))){console.warn("There is already a matching push subscription registered");return}await c.from(u).insert([{subscription:JSON.stringify(t),email:n()}]);return}const s=await i.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:I});await c.from(u).insert([{subscription:JSON.stringify(s),email:n()}])})})},E=()=>{D();const[i,t]=h(!1);let n;window.addEventListener("beforeinstallprompt",e=>{e.preventDefault();const r=Number(window?.localStorage?.getItem(p));r&&r+y>Date.now()||(n=e,setTimeout(()=>t(!0),1e3))});const s=async()=>{t(!1),n.prompt(),await n.userChoice,n=null},a=()=>{window?.localStorage?.setItem(p,Date.now().toString()),t(!1)};return l(w,{get when(){return i()},get children(){const e=_.cloneNode(!0),r=e.firstChild,o=r.nextSibling,S=o.nextSibling,f=S.nextSibling;return m(e,l(d,{onClick:s,children:"Install murmur"}),f),m(e,l(d,{onClick:a,children:"Not now"}),null),e}})};export{E as default};
