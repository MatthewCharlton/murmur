import{c as j,a as f,o as N,b as r,u as x,d as D,e as S,t as v,f as M,R as k,g as _,S as $,m as V,i as g,L,l,h as W,r as z,j as G}from"./vendor.43e5c33f.js";const H=function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerpolicy&&(n.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?n.credentials="include":e.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(e){if(e.ep)return;e.ep=!0;const n=t(e);fetch(e.href,n)}};H();const b=D(),J="https://umyqzzqlfvdupowmybfs.supabase.co",U="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlIjoiYW5vbiIsImlhdCI6MTYzMTkzMTIwOCwiZXhwIjoxOTQ3NTA3MjA4fQ.9_yqUYeJRjf5tCyhdXK69Kro_zF4-JXA_zSVfgcL-t8",d=j(J,U);let h=null;const[q,I]=f(""),[K,X]=f("/murmur/"),[w,C]=f([]),A=(o,i)=>{navigator.serviceWorker.ready.then(async t=>{navigator.serviceWorker.controller?.postMessage({type:o,payload:i})})},Y=o=>{const[i,t]=f(),[s,e]=f(),n=async()=>{if(!w().length){const{data:c,error:u}=await d.from("chat-data").select().order("id",{ascending:!0});if(t(!1),u){if(e(u.message),!h)return;d.removeSubscription(h),h=null;return}if(!c)return;C(c),A("LAST_MESSAGE_ID",c)}},a=()=>{S(()=>{h=d.from("chat-data").on("*",c=>{console.log("payload",c),C(u=>(u.push(c.new),u)),A("LAST_MESSAGE_ID",[c.new])}).subscribe()})},p=d.auth.user()?.email;p&&I(p),d.auth.onAuthStateChange((c,u)=>{console.log("onAuthStateChange",{event:c,session:u}),c==="SIGNED_OUT"&&I(""),c==="SIGNED_IN"&&(console.log("event",c,u?.user?.email),I(u?.user?.email||""),n(),a())});const{hash:E,pathname:T}=window.location;E&&T==="/murmur/"&&X(E),N(()=>{console.log("onCleanup called"),!!h&&d.removeSubscription(h)});const O={supabase:d,username:q,routeHash:K,messages:w};return r(b.Provider,{value:O,get children(){return o.children}})};function B(){return x(b)}const F="modulepreload",R={},Q="/murmur/",m=function(i,t){return!t||t.length===0?i():Promise.all(t.map(s=>{if(s=`${Q}${s}`,s in R)return;R[s]=!0;const e=s.endsWith(".css"),n=e?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${s}"]${n}`))return;const a=document.createElement("link");if(a.rel=e?"stylesheet":F,e||(a.as="script",a.crossOrigin=""),a.href=s,document.head.appendChild(a),e)return new Promise((y,p)=>{a.addEventListener("load",y),a.addEventListener("error",p)})})).then(()=>i())},Z=v("<div><p>This link has expired</p></div>"),ee=v('<div class="flex flex-col col-span-6 lg:col-span-4 lg:col-start-2"></div>'),P=v('<div class="col-span-6"></div>'),te=l(()=>m(()=>import("./index.7020418d.js"),["assets/index.7020418d.js","assets/vendor.43e5c33f.js","assets/index.a049a178.js"])),re=l(()=>m(()=>import("./index.a2e05c3e.js"),["assets/index.a2e05c3e.js","assets/vendor.43e5c33f.js"])),se=l(()=>m(()=>import("./index.4474b622.js"),["assets/index.4474b622.js","assets/vendor.43e5c33f.js"])),ne=l(()=>m(()=>import("./MessageList.ec63d831.js"),["assets/MessageList.ec63d831.js","assets/vendor.43e5c33f.js"])),oe=l(()=>m(()=>import("./MessageCompose.93ecf190.js"),["assets/MessageCompose.93ecf190.js","assets/vendor.43e5c33f.js"])),ae=l(()=>m(()=>import("./SignIn.85982497.js"),["assets/SignIn.85982497.js","assets/vendor.43e5c33f.js","assets/index.a049a178.js"])),ie=l(()=>m(()=>import("./ResetPassword.0ccf7d2a.js"),["assets/ResetPassword.0ccf7d2a.js","assets/vendor.43e5c33f.js","assets/index.a049a178.js"])),ce=()=>{const o=B(),i=M();return S(()=>{const t=W(),s=o.routeHash();if(t.pathname==="/murmur"&&(window.location.pathname="/murmur/"),s&&(s.endsWith("&type=recovery")&&i(`/murmur/reset-password/${s}`),s.startsWith("#error_code=404")))return(()=>{const e=Z.cloneNode(!0);return e.firstChild,g(e,r(L,{href:"/murmur/",style:{cursor:"pointer"},children:"Back to app"}),null),e})()}),r(re,{get children(){return[r(te,{}),r(se,{}),r(k,{get children(){return[r(_,{path:"/murmur/",get element(){return r($,{get when(){return!!o?.username()},get fallback(){return V(()=>i("/murmur/sign-in"))},get children(){const t=ee.cloneNode(!0);return g(t,r(ne,{get messages(){return o?.messages()}}),null),g(t,r(oe,{}),null),t}})}}),r(_,{path:"/murmur/sign-in",get element(){return(()=>{const t=P.cloneNode(!0);return g(t,r(ae,{})),t})()}}),r(_,{path:"/murmur/reset-password",get element(){return(()=>{const t=P.cloneNode(!0);return g(t,r(ie,{})),t})()}}),r(_,{path:"/*all",get element(){return["Not found",r(L,{class:"",href:"/murmur/",children:"Go home"})]}})]}})]}})};navigator.serviceWorker.register("sw.js").then(o=>{console.log("Registration succeeded. Scope is "+o.scope)}).catch(o=>{console.log("Registration failed with "+o)});z(()=>r(Y,{get children(){return r(G,{get children(){return r(ce,{})}})}}),document.getElementById("root"));export{m as _,B as u};
