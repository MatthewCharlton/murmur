import{c as x,a as h,o as $,b as r,u as V,d as W,g as z,s as G,t as E,e as H,f as J,R as q,h as p,S as B,m as K,i as g,L as A,l as d,j as U,r as X,k as Y}from"./vendor.f206e712.js";const F=function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerpolicy&&(n.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?n.credentials="include":e.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(e){if(e.ep)return;e.ep=!0;const n=t(e);fetch(e.href,n)}};F();const Q="https://umyqzzqlfvdupowmybfs.supabase.co",Z="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlIjoiYW5vbiIsImlhdCI6MTYzMTkzMTIwOCwiZXhwIjoxOTQ3NTA3MjA4fQ.9_yqUYeJRjf5tCyhdXK69Kro_zF4-JXA_zSVfgcL-t8",l=x(Q,Z),I="chat-data",ee="last-seen-message";let f=null;const[te,y]=h(""),[re,se]=h("/murmur/"),[T,w]=h([]),C={supabase:l,username:te,routeHash:re,messages:T},R=W(C),D=(i,c)=>{navigator.serviceWorker?.ready.then(async t=>{navigator.serviceWorker.controller?.postMessage({type:i,payload:c})})},ne=i=>{const[c,t]=h(),[s,e]=h(),n=async()=>{if(window?.document.hidden)return;const o=await z(ee);if(!o)return;const{id:u=0}=o,{data:v,error:b}=await l.from(I).select().gt("id",u);if(b){console.error(b);return}!v||!v.length||w(j=>[...j,...v])};window?.addEventListener("visibilitychange",n);const a=async()=>{if(!T().length){const{data:o,error:u}=await l.from(I).select().order("id",{ascending:!0});if(t(!1),u){if(e(u.message),!f)return;l.removeSubscription(f),f=null;return}if(!o||!o.length)return;w(o),D("LAST_MESSAGE_ID",o)}},_=()=>{f=l.from(I).on("*",o=>{w(u=>[...u,o.new]),D("LAST_MESSAGE_ID",[o.new])}).subscribe()},N=l.auth.user()?.email||"";y(N);const O=o=>{o&&G("session-token",o)};l.auth.onAuthStateChange((o,u)=>{o==="SIGNED_OUT"&&y(""),o==="SIGNED_IN"&&(y(u?.user?.email||""),O(u),a(),_())});const{hash:L,pathname:k}=window?.location;return L&&k==="/murmur/"&&se(L),$(()=>{window?.removeEventListener("visibilitychange",n),!!f&&l.removeSubscription(f)}),r(R.Provider,{value:C,get children(){return i.children}})};function oe(){return V(R)||{}}const ie="modulepreload",P={},ae="/murmur/",m=function(c,t){return!t||t.length===0?c():Promise.all(t.map(s=>{if(s=`${ae}${s}`,s in P)return;P[s]=!0;const e=s.endsWith(".css"),n=e?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${s}"]${n}`))return;const a=document.createElement("link");if(a.rel=e?"stylesheet":ie,e||(a.as="script",a.crossOrigin=""),a.href=s,document.head.appendChild(a),e)return new Promise((_,S)=>{a.addEventListener("load",_),a.addEventListener("error",S)})})).then(()=>c())},ce=E("<div><p>This link has expired</p></div>"),ue=E('<div class="flex flex-col col-span-6 lg:col-span-4 lg:col-start-2"></div>'),M=E('<div class="col-span-6"></div>'),le=d(()=>m(()=>import("./index.9275d15c.js"),["assets/index.9275d15c.js","assets/vendor.f206e712.js","assets/index.f0a0dd41.js","assets/getUserDataFromLocalStorage.2848a4af.js"])),de=d(()=>m(()=>import("./index.b7207669.js"),["assets/index.b7207669.js","assets/vendor.f206e712.js"])),me=d(()=>m(()=>import("./index.a0fb27a7.js"),["assets/index.a0fb27a7.js","assets/vendor.f206e712.js"])),fe=d(()=>m(()=>import("./MessageList.a2c123a1.js"),["assets/MessageList.a2c123a1.js","assets/vendor.f206e712.js","assets/getUserDataFromLocalStorage.2848a4af.js"])),he=d(()=>m(()=>import("./MessageCompose.2d8f56dd.js"),["assets/MessageCompose.2d8f56dd.js","assets/vendor.f206e712.js"])),ge=d(()=>m(()=>import("./SignIn.8d9fd790.js"),["assets/SignIn.8d9fd790.js","assets/vendor.f206e712.js","assets/index.f0a0dd41.js"])),pe=d(()=>m(()=>import("./ResetPassword.1346d4f8.js"),["assets/ResetPassword.1346d4f8.js","assets/vendor.f206e712.js","assets/index.f0a0dd41.js"])),_e=()=>{const i=oe(),c=H();return J(()=>{const t=U(),s=i.routeHash();if(t.pathname==="/murmur"&&(window.location.pathname="/murmur/"),s&&(s.endsWith("&type=recovery")&&c(`/murmur/reset-password/${s}`),s.startsWith("#error_code=404")))return(()=>{const e=ce.cloneNode(!0);return e.firstChild,g(e,r(A,{href:"/murmur/",style:{cursor:"pointer"},children:"Back to app"}),null),e})()}),r(de,{get children(){return[r(le,{}),r(me,{}),r(q,{get children(){return[r(p,{path:"/murmur/",get element(){return r(B,{get when(){return!!i?.username()},get fallback(){return K(()=>c("/murmur/sign-in"))},get children(){const t=ue.cloneNode(!0);return g(t,r(fe,{get messages(){return i.messages()}}),null),g(t,r(he,{}),null),t}})}}),r(p,{path:"/murmur/sign-in",get element(){return(()=>{const t=M.cloneNode(!0);return g(t,r(ge,{})),t})()}}),r(p,{path:"/murmur/reset-password",get element(){return(()=>{const t=M.cloneNode(!0);return g(t,r(pe,{})),t})()}}),r(p,{path:"/*all",get element(){return["Not found",r(A,{class:"",href:"/murmur/",children:"Go home"})]}})]}})]}})};navigator.serviceWorker.register("sw.js").then(async i=>{console.log("Registration succeeded. Scope is "+i.scope)}).catch(i=>{console.log("Registration failed with "+i)});X(()=>r(ne,{get children(){return r(Y,{get children(){return r(_e,{})}})}}),document.getElementById("root"));export{m as _,l as s,oe as u};
