import{c as w,a as l,i as m,S as b,t as h,u as g,s as c,D as u}from"./index-77142ebd.js";import d from"./index-5844a2ca.js";import"./browser-ponyfill-5ce9a37a.js";const _=h('<div class="fixed bottom-5 mx-5 right-0 z-10 bg-white border-2 p-4 max-w-md min-h-10">Install the murmur web app to your device<br><br> </div>'),I="BJfNA6Vn9RS-6mQq5mnS7nZrMMzUQUcG9_fkMab_dj3dmxrzCewj-WRSijzs0kbYQVteJbS-9dMcDn-4wAfm4Dk",p="murmur-pwa-install-decline",D=7889238e3,N=()=>{"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(async i=>{i.pushManager.getSubscription().then(async t=>{const n=g().username;if(t){const{data:s,error:e}=await c.from(u).select();if(e){console.error(e);return}s.some(({subscription:o})=>o===t)||await c.from(u).insert([{subscription:JSON.stringify(t),email:n()}]);return}const a=await i.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:I});await c.from(u).insert([{subscription:JSON.stringify(a),email:n()}])})})},E=()=>{N();const[i,t]=w(!1);let n;window.addEventListener("beforeinstallprompt",e=>{e.preventDefault();const r=Number(window?.localStorage?.getItem(p));r&&r+D>Date.now()||(n=e,setTimeout(()=>t(!0),1e3))});const a=async()=>{t(!1),n.prompt(),await n.userChoice,n=null},s=()=>{window?.localStorage?.setItem(p,Date.now().toString()),t(!1)};return l(b,{get when(){return i()},get children(){const e=_.cloneNode(!0),r=e.firstChild,o=r.nextSibling,S=o.nextSibling,f=S.nextSibling;return m(e,l(d,{onClick:a,children:"Install murmur"}),f),m(e,l(d,{onClick:s,children:"Not now"}),null),e}})};export{E as default};
