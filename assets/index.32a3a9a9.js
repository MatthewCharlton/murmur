import{c as j,a as h,o as x,b as s,u as $,d as V,g as W,s as z,t as v,e as G,f as H,R as J,h as p,S as q,m as B,i as f,L,l as d,j as K,r as U,k as X}from"./vendor.f206e712.js";const Y=function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))n(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function t(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerpolicy&&(o.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?o.credentials="include":e.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(e){if(e.ep)return;e.ep=!0;const o=t(e);fetch(e.href,o)}};Y();const A=V(),F="https://umyqzzqlfvdupowmybfs.supabase.co",Q="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlIjoiYW5vbiIsImlhdCI6MTYzMTkzMTIwOCwiZXhwIjoxOTQ3NTA3MjA4fQ.9_yqUYeJRjf5tCyhdXK69Kro_zF4-JXA_zSVfgcL-t8",u=j(F,Q),E="chat-data",Z="last-seen-message";let g=null;const[ee,I]=h(""),[te,re]=h("/murmur/"),[C,y]=h([]),T=(a,l)=>{navigator.serviceWorker.ready.then(async t=>{navigator.serviceWorker.controller?.postMessage({type:a,payload:l})})},se=a=>{const[l,t]=h(),[n,e]=h(),o=async()=>{if(window?.document.hidden)return;const{id:r}=await W(Z);if(!r)return;const{data:i,error:S}=await u.from(E).select().gt("id",r);if(S){console.error(S);return}!i||!i.length||(console.log("data",i),y(k=>[...k,...i]))};window?.addEventListener("visibilitychange",o);const c=async()=>{if(!C().length){const{data:r,error:i}=await u.from(E).select().order("id",{ascending:!0});if(t(!1),i){if(e(i.message),!g)return;u.removeSubscription(g),g=null;return}if(!r||!r.length)return;y(r),T("LAST_MESSAGE_ID",r)}},_=()=>{g=u.from(E).on("*",r=>{console.log("payload",r),y(i=>[...i,r.new]),T("LAST_MESSAGE_ID",[r.new])}).subscribe()},P=u.auth.user()?.email||"";I(P);const M=r=>{r&&z("session-token",r)};u.auth.onAuthStateChange((r,i)=>{console.log("onAuthStateChange",{event:r,session:i}),r==="SIGNED_OUT"&&I(""),r==="SIGNED_IN"&&(console.log("event",r,i,i?.user?.email),I(i?.user?.email||""),M(i),c(),_())});const{hash:w,pathname:N}=window.location;w&&N==="/murmur/"&&re(w),x(()=>{console.log("onCleanup called"),window?.removeEventListener("visibilitychange",o),!!g&&u.removeSubscription(g)});const O={supabase:u,username:ee,routeHash:te,messages:C};return s(A.Provider,{value:O,get children(){return a.children}})};function ne(){return $(A)}const oe="modulepreload",R={},ie="/murmur/",m=function(l,t){return!t||t.length===0?l():Promise.all(t.map(n=>{if(n=`${ie}${n}`,n in R)return;R[n]=!0;const e=n.endsWith(".css"),o=e?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${n}"]${o}`))return;const c=document.createElement("link");if(c.rel=e?"stylesheet":oe,e||(c.as="script",c.crossOrigin=""),c.href=n,document.head.appendChild(c),e)return new Promise((_,b)=>{c.addEventListener("load",_),c.addEventListener("error",b)})})).then(()=>l())},ae=v("<div><p>This link has expired</p></div>"),ce=v('<div class="flex flex-col col-span-6 lg:col-span-4 lg:col-start-2"></div>'),D=v('<div class="col-span-6"></div>'),le=d(()=>m(()=>import("./index.b8eb15e8.js"),["assets/index.b8eb15e8.js","assets/vendor.f206e712.js","assets/index.f0a0dd41.js"])),ue=d(()=>m(()=>import("./index.b7207669.js"),["assets/index.b7207669.js","assets/vendor.f206e712.js"])),de=d(()=>m(()=>import("./index.4099bdc6.js"),["assets/index.4099bdc6.js","assets/vendor.f206e712.js"])),me=d(()=>m(()=>import("./MessageList.e44f61a6.js"),["assets/MessageList.e44f61a6.js","assets/vendor.f206e712.js"])),ge=d(()=>m(()=>import("./MessageCompose.d2b2d5d5.js"),["assets/MessageCompose.d2b2d5d5.js","assets/vendor.f206e712.js"])),he=d(()=>m(()=>import("./SignIn.3a93c45e.js"),["assets/SignIn.3a93c45e.js","assets/vendor.f206e712.js","assets/index.f0a0dd41.js"])),fe=d(()=>m(()=>import("./ResetPassword.039c72fb.js"),["assets/ResetPassword.039c72fb.js","assets/vendor.f206e712.js","assets/index.f0a0dd41.js"])),pe=()=>{const a=ne(),l=G();return H(()=>{const t=K(),n=a?.routeHash();if(t.pathname==="/murmur"&&(console.log("location.pathname",t.pathname),window.location.pathname="/murmur/"),n&&(n.endsWith("&type=recovery")&&l(`/murmur/reset-password/${n}`),n.startsWith("#error_code=404")))return(()=>{const e=ae.cloneNode(!0);return e.firstChild,f(e,s(L,{href:"/murmur/",style:{cursor:"pointer"},children:"Back to app"}),null),e})()}),s(ue,{get children(){return[s(le,{}),s(de,{}),s(J,{get children(){return[s(p,{path:"/murmur/",get element(){return s(q,{get when(){return!!a?.username()},get fallback(){return B(()=>l("/murmur/sign-in"))},get children(){const t=ce.cloneNode(!0);return f(t,s(me,{get messages(){return a?.messages()}}),null),f(t,s(ge,{}),null),t}})}}),s(p,{path:"/murmur/sign-in",get element(){return(()=>{const t=D.cloneNode(!0);return f(t,s(he,{})),t})()}}),s(p,{path:"/murmur/reset-password",get element(){return(()=>{const t=D.cloneNode(!0);return f(t,s(fe,{})),t})()}}),s(p,{path:"/*all",get element(){return["Not found",s(L,{class:"",href:"/murmur/",children:"Go home"})]}})]}})]}})};navigator.serviceWorker.register("sw.js").then(a=>{console.log("Registration succeeded. Scope is "+a.scope)}).catch(a=>{console.log("Registration failed with "+a)});U(()=>s(se,{get children(){return s(X,{get children(){return s(pe,{})}})}}),document.getElementById("root"));export{m as _,ne as u};
