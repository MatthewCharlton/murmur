import{c as S,a as o,i as u,S as g,t as h,u as b,s as l,D as c}from"./index-8f04267c.js";import m from"./index-c18b42ad.js";import"./browser-ponyfill-5ce9a37a.js";const _=h('<div class="fixed bottom-5 mx-5 right-0 z-10 bg-white border-2 p-4 max-w-md min-h-10">Install the murmur web app to your device<br><br> </div>'),I="BJfNA6Vn9RS-6mQq5mnS7nZrMMzUQUcG9_fkMab_dj3dmxrzCewj-WRSijzs0kbYQVteJbS-9dMcDn-4wAfm4Dk",d="murmur-pwa-install-decline",y=7889238e3,D=()=>{"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(async r=>{r.pushManager.getSubscription().then(async t=>{const n=b().username;if(t){const{data:s,error:e}=await l.from(c).select().eq("subscription",JSON.stringify(t));if(e){console.error(e);return}if(s.length>0){console.warn("There is already a matching subscription registered");return}await l.from(c).insert([{subscription:JSON.stringify(t),email:n()}]);return}const i=await r.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:I});await l.from(c).insert([{subscription:JSON.stringify(i),email:n()}])})})},E=()=>{D();const[r,t]=S(!1);let n;window.addEventListener("beforeinstallprompt",e=>{e.preventDefault();const a=Number(window?.localStorage?.getItem(d));a&&a+y>Date.now()||(n=e,setTimeout(()=>t(!0),1e3))});const i=async()=>{t(!1),n.prompt(),await n.userChoice,n=null},s=()=>{window?.localStorage?.setItem(d,Date.now().toString()),t(!1)};return o(g,{get when(){return r()},get children(){const e=_.cloneNode(!0),a=e.firstChild,p=a.nextSibling,f=p.nextSibling,w=f.nextSibling;return u(e,o(m,{onClick:i,children:"Install murmur"}),w),u(e,o(m,{onClick:s,children:"Not now"}),null),e}})};export{E as default};
