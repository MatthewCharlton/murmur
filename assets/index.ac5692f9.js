import{c as O,a as f,o as j,b as r,u as N,d as x,t as v,e as D,f as M,R as k,g as _,S as $,m as V,i as g,L as b,l,h as W,r as z,j as G}from"./vendor.bb69e759.js";const H=function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerpolicy&&(n.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?n.credentials="include":e.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(e){if(e.ep)return;e.ep=!0;const n=t(e);fetch(e.href,n)}};H();const S=x(),J="https://umyqzzqlfvdupowmybfs.supabase.co",U="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlIjoiYW5vbiIsImlhdCI6MTYzMTkzMTIwOCwiZXhwIjoxOTQ3NTA3MjA4fQ.9_yqUYeJRjf5tCyhdXK69Kro_zF4-JXA_zSVfgcL-t8",d=O(J,U);let h=null;const[q,I]=f(""),[K,X]=f("/murmur/"),[L,w]=f([]),C=(o,i)=>{navigator.serviceWorker.ready.then(async t=>{navigator.serviceWorker.controller?.postMessage({type:o,payload:i})})},Y=o=>{const[i,t]=f(),[s,e]=f(),n=async()=>{if(!L().length){const{data:c,error:u}=await d.from("chat-data").select().order("id",{ascending:!0});if(t(!1),u){if(e(u.message),!h)return;d.removeSubscription(h),h=null;return}if(!c)return;w(c),C("LAST_MESSAGE_ID",c)}},a=()=>{h=d.from("chat-data").on("*",c=>{console.log("payload",c),w(u=>(u.push(c.new),u)),C("LAST_MESSAGE_ID",[c.new])}).subscribe()},p=d.auth.user()?.email;p&&I(p),d.auth.onAuthStateChange((c,u)=>{console.log("onAuthStateChange",{event:c,session:u}),c==="SIGNED_OUT"&&I(""),c==="SIGNED_IN"&&(console.log("event",c,u?.user?.email),I(u?.user?.email||""),n(),a())});const{hash:E,pathname:P}=window.location;E&&P==="/murmur/"&&X(E),j(()=>{!h||d.removeSubscription(h)});const T={supabase:d,username:q,routeHash:K,messages:L};return r(S.Provider,{value:T,get children(){return o.children}})};function B(){return N(S)}const F="modulepreload",A={},Q="/murmur/",m=function(i,t){return!t||t.length===0?i():Promise.all(t.map(s=>{if(s=`${Q}${s}`,s in A)return;A[s]=!0;const e=s.endsWith(".css"),n=e?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${s}"]${n}`))return;const a=document.createElement("link");if(a.rel=e?"stylesheet":F,e||(a.as="script",a.crossOrigin=""),a.href=s,document.head.appendChild(a),e)return new Promise((y,p)=>{a.addEventListener("load",y),a.addEventListener("error",p)})})).then(()=>i())},Z=v("<div><p>This link has expired</p></div>"),ee=v('<div class="flex flex-col col-span-6 lg:col-span-4 lg:col-start-2"></div>'),R=v('<div class="col-span-6"></div>'),te=l(()=>m(()=>import("./index.b0a045ab.js"),["assets/index.b0a045ab.js","assets/vendor.bb69e759.js","assets/index.90bf2a70.js"])),re=l(()=>m(()=>import("./index.0e9f3540.js"),["assets/index.0e9f3540.js","assets/vendor.bb69e759.js"])),se=l(()=>m(()=>import("./index.157e357f.js"),["assets/index.157e357f.js","assets/vendor.bb69e759.js"])),ne=l(()=>m(()=>import("./MessageList.85d493f9.js"),["assets/MessageList.85d493f9.js","assets/vendor.bb69e759.js"])),oe=l(()=>m(()=>import("./MessageCompose.1eed0258.js"),["assets/MessageCompose.1eed0258.js","assets/vendor.bb69e759.js"])),ae=l(()=>m(()=>import("./SignIn.d7f38d38.js"),["assets/SignIn.d7f38d38.js","assets/vendor.bb69e759.js","assets/index.90bf2a70.js"])),ie=l(()=>m(()=>import("./ResetPassword.8ed05038.js"),["assets/ResetPassword.8ed05038.js","assets/vendor.bb69e759.js","assets/index.90bf2a70.js"])),ce=()=>{const o=B(),i=D();return M(()=>{const t=W(),s=o.routeHash();if(console.log("location",t.pathname),t.pathname==="/murmur"&&(window.location.pathname="/murmur/"),s&&(s.endsWith("&type=recovery")&&i(`/murmur/reset-password/${s}`),s.startsWith("#error_code=404")))return(()=>{const e=Z.cloneNode(!0);return e.firstChild,g(e,r(b,{href:"/murmur/",style:{cursor:"pointer"},children:"Back to app"}),null),e})()}),r(re,{get children(){return[r(te,{}),r(se,{}),r(k,{get children(){return[r(_,{path:"/murmur/",get element(){return r($,{get when(){return!!o?.username()},get fallback(){return V(()=>i("/murmur/sign-in"))},get children(){const t=ee.cloneNode(!0);return g(t,r(ne,{get messages(){return o?.messages()}}),null),g(t,r(oe,{}),null),t}})}}),r(_,{path:"/murmur/sign-in",get element(){return(()=>{const t=R.cloneNode(!0);return g(t,r(ae,{})),t})()}}),r(_,{path:"/murmur/reset-password",get element(){return(()=>{const t=R.cloneNode(!0);return g(t,r(ie,{})),t})()}}),r(_,{path:"/*all",get element(){return["Not found",r(b,{class:"",href:"/murmur/",children:"Go home"})]}})]}})]}})};navigator.serviceWorker.register("sw.js").then(o=>{console.log("Registration succeeded. Scope is "+o.scope)}).catch(o=>{console.log("Registration failed with "+o)});z(()=>r(Y,{get children(){return r(G,{get children(){return r(ce,{})}})}}),document.getElementById("root"));export{m as _,B as u};
