import{c as O,a as g,o as M,b as r,u as N,d as j,t as v,e as x,f as D,i as h,L as S,R as k,g as _,S as $,m as V,l,r as W,h as z}from"./vendor.eefe3fb1.js";const G=function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver(t=>{for(const s of t)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&e(i)}).observe(document,{childList:!0,subtree:!0});function o(t){const s={};return t.integrity&&(s.integrity=t.integrity),t.referrerpolicy&&(s.referrerPolicy=t.referrerpolicy),t.crossorigin==="use-credentials"?s.credentials="include":t.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function e(t){if(t.ep)return;t.ep=!0;const s=o(t);fetch(t.href,s)}};G();const L=j(),H="https://umyqzzqlfvdupowmybfs.supabase.co",J="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlIjoiYW5vbiIsImlhdCI6MTYzMTkzMTIwOCwiZXhwIjoxOTQ3NTA3MjA4fQ.9_yqUYeJRjf5tCyhdXK69Kro_zF4-JXA_zSVfgcL-t8",d=O(H,J);let f=null;const[U,I]=g(""),[q,K]=g("/murmur/"),[b,C]=g([]),w=(n,a)=>{navigator.serviceWorker.ready.then(async o=>{navigator.serviceWorker.controller?.postMessage({type:n,payload:a})})},X=n=>{const[a,o]=g(),[e,t]=g(),s=async()=>{if(!b().length){const{data:c,error:u}=await d.from("chat-data").select().order("id",{ascending:!0});if(o(!1),u){if(t(u.message),!f)return;d.removeSubscription(f),f=null;return}if(!c)return;C(c),w("LAST_MESSAGE_ID",c)}},i=()=>{f=d.from("chat-data").on("*",c=>{console.log("payload",c),C(u=>[...u,c.new]),w("LAST_MESSAGE_ID",c.new)}).subscribe()},p=d.auth.user()?.email;p&&I(p),d.auth.onAuthStateChange((c,u)=>{console.log("onAuthStateChange",{event:c,session:u}),c==="SIGNED_OUT"&&I(""),c==="SIGNED_IN"&&(console.log("event",c,u?.user?.email),I(u?.user?.email||""),s(),i())});const{hash:E,pathname:P}=window.location;E&&P==="/murmur/"&&K(E),M(()=>{!f||d.removeSubscription(f)});const T={supabase:d,username:U,routeHash:q,messages:b};return r(L.Provider,{value:T,get children(){return n.children}})};function Y(){return N(L)}const B="modulepreload",A={},F="/murmur/",m=function(a,o){return!o||o.length===0?a():Promise.all(o.map(e=>{if(e=`${F}${e}`,e in A)return;A[e]=!0;const t=e.endsWith(".css"),s=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${s}`))return;const i=document.createElement("link");if(i.rel=t?"stylesheet":B,t||(i.as="script",i.crossOrigin=""),i.href=e,document.head.appendChild(i),t)return new Promise((y,p)=>{i.addEventListener("load",y),i.addEventListener("error",p)})})).then(()=>a())},Q=v("<div><p>This link has expired</p></div>"),Z=v('<div class="flex flex-col col-span-6 lg:col-span-4 lg:col-start-2"></div>'),R=v('<div class="col-span-6"></div>'),ee=l(()=>m(()=>import("./index.c8fe99d7.js"),["assets/index.c8fe99d7.js","assets/vendor.eefe3fb1.js","assets/index.3392c7d7.js"])),te=l(()=>m(()=>import("./index.633a3fd7.js"),["assets/index.633a3fd7.js","assets/vendor.eefe3fb1.js"])),re=l(()=>m(()=>import("./index.0d4015e4.js"),["assets/index.0d4015e4.js","assets/vendor.eefe3fb1.js"])),se=l(()=>m(()=>import("./MessageList.1998c952.js"),["assets/MessageList.1998c952.js","assets/vendor.eefe3fb1.js"])),ne=l(()=>m(()=>import("./MessageCompose.15e65ed9.js"),["assets/MessageCompose.15e65ed9.js","assets/vendor.eefe3fb1.js"])),oe=l(()=>m(()=>import("./SignIn.30d94e20.js"),["assets/SignIn.30d94e20.js","assets/vendor.eefe3fb1.js","assets/index.3392c7d7.js"])),ie=l(()=>m(()=>import("./ResetPassword.1af53b70.js"),["assets/ResetPassword.1af53b70.js","assets/vendor.eefe3fb1.js","assets/index.3392c7d7.js"])),ae=()=>{const n=Y(),a=x();D();const o=n.routeHash();return o&&(o.endsWith("&type=recovery")&&a(`/murmur/reset-password/${o}`),o.startsWith("#error_code=404"))?(()=>{const e=Q.cloneNode(!0);return e.firstChild,h(e,r(S,{href:"/murmur/",style:{cursor:"pointer"},children:"Back to app"}),null),e})():(console.log("username",n.username()),r(te,{get children(){return[r(ee,{}),r(re,{}),r(k,{get children(){return[r(_,{path:"/murmur/",get element(){return r($,{get when(){return!!n.username()},get fallback(){return[V(()=>a("/murmur/sign-in"))," "]},get children(){const e=Z.cloneNode(!0);return h(e,r(se,{get messages(){return n.messages()}}),null),h(e,r(ne,{}),null),e}})}}),r(_,{path:"/murmur/sign-in",get element(){return(()=>{const e=R.cloneNode(!0);return h(e,r(oe,{})),e})()}}),r(_,{path:"/murmur/reset-password",get element(){return(()=>{const e=R.cloneNode(!0);return h(e,r(ie,{})),e})()}}),r(_,{path:"/*all",get element(){return["Not found",r(S,{class:"",href:"/murmur/",children:"Go home"})]}})]}})]}}))};navigator.serviceWorker.register("sw.js").then(n=>{console.log("Registration succeeded. Scope is "+n.scope)}).catch(n=>{console.log("Registration failed with "+n)});W(()=>r(X,{get children(){return r(z,{get children(){return r(ae,{})}})}}),document.getElementById("root"));export{m as _,Y as u};
