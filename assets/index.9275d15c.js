import{t as w,a as f,b as i,i as l,S as h}from"./vendor.f206e712.js";import c from"./index.f0a0dd41.js";import{s as b}from"./index.0ee7d13c.js";import{g as y}from"./getUserDataFromLocalStorage.2848a4af.js";function S(n){if(!n)return new Uint8Array;const a="=".repeat((4-n.length%4)%4),t=(n+a).replace(/\-/g,"+").replace(/_/g,"/"),r=window?.atob(t)||"",o=new Uint8Array(r.length);for(let e=0;e<r.length;++e)o[e]=r.charCodeAt(e);return o}const I=w('<div class="fixed bottom-5 mx-5 right-0 z-10 bg-white border-2 p-4 max-w-md min-h-10">Install the murmur web app to enable background message updates so you can be notified when you get a new message<br><br> </div>'),_={}.VAPID_PUBLIC_KEY,d="murmur-pwa-install-decline",u="get-latest-messages";"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(async n=>{y(),navigator.serviceWorker.ready.then(async t=>{await t.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:S(_)}),b.from("push-subs").insert()}),(await navigator.permissions.query({name:"periodic-background-sync"})).state==="granted"&&"periodicSync"in n&&n.periodicSync.getTags().then(async t=>{if(!t.includes(u))try{await n.periodicSync.register(u,{minInterval:5*60*1e3})}catch{console.log("Periodic Sync could not be registered!")}})});const x=()=>{const[n,a]=f(!1);let t;window.addEventListener("beforeinstallprompt",e=>{e.preventDefault();const s=Number(window?.localStorage?.getItem(d));s&&s+3*60*60*1e3>Date.now()||(t=e,setTimeout(()=>a(!0),1e3))});const r=async()=>{a(!1),t.prompt(),await t.userChoice,t=null},o=()=>{window?.localStorage?.setItem(d,Date.now().toString()),a(!1)};return i(h,{get when(){return n()},get children(){const e=I.cloneNode(!0),s=e.firstChild,g=s.nextSibling,m=g.nextSibling,p=m.nextSibling;return l(e,i(c,{onClick:r,children:"Install murmur"}),p),l(e,i(c,{onClick:o,children:"Not now"}),null),e}})};export{x as default};
